<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="üìù Solicita√ß√£o de Or√ßamento Online">
    <meta property="og:description" content="Clique aqui para preencher seus dados e solicitar seu or√ßamento rapidamente.">
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/1611/1611154.png"> <title>Solicita√ß√£o de Or√ßamento | Natanjkl</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --dark: #1e293b; --light: #f8fafc; --danger: #ef4444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); margin: 0; padding: 15px; color: var(--dark); line-height: 1.6; }
        .container { max-width: 650px; margin: auto; }
        .card { background: white; border-radius: 24px; padding: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.06); margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.3); }
        h2, h3 { color: var(--primary); margin-top: 0; text-align: center; font-weight: 600; }
        label { display: block; font-size: 0.85em; font-weight: 600; margin-bottom: 6px; color: #64748b; }
        input, select, textarea { font-size: 16px !important; width: 100%; padding: 14px; border: 2px solid #f1f5f9; border-radius: 12px; margin-bottom: 15px; font-family: inherit; transition: all 0.3s ease; background: #f8fafc; }
        input:focus { border-color: var(--primary); background: white; }
        .btn { padding: 16px 20px; border-radius: 14px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; width: 100%; touch-action: manipulation; font-size: 1em; gap: 8px; }
        .btn-confirm { background: var(--secondary); color: white; box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3); }
        .btn-main { background: var(--primary); color: white; box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3); }
        .btn-outline { background: transparent; color: #64748b; border: 2px solid #e2e8f0; }
        .tabs { display: flex; gap: 8px; margin-bottom: 25px; background: #f1f5f9; padding: 6px; border-radius: 18px; overflow-x: auto; }
        .tab { flex: 1; text-align: center; padding: 12px 18px; cursor: pointer; border-radius: 12px; font-size: 0.85em; white-space: nowrap; color: #64748b; }
        .tab.active { background: white; color: var(--primary); font-weight: 600; }
        .hidden { display: none; }
        .item-row { display: grid; grid-template-columns: 2fr 0.8fr 1fr 45px; gap: 8px; margin-bottom: 12px; background: #f8fafc; padding: 10px; border-radius: 12px; }
        .pedido-card { background: #f8fafc; padding: 15px; border-radius: 16px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
        @media print { .no-print { display: none !important; } #area-impressao { display: block !important; } }
    </style>
</head>
<body>

<div class="container no-print">

    <div id="view-cliente" class="card">
        <h2 id="topo-nome-empresa">Solicita√ß√£o de Or√ßamento</h2>
        <div id="form-cliente">
            <label>Nome Completo</label>
            <input type="text" id="c-nome" placeholder="Seu nome">
            <label>WhatsApp</label>
            <input type="tel" id="c-tel" placeholder="(00) 00000-0000" oninput="maskTel(this)">
            <label>Endere√ßo / Local</label>
            <input type="text" id="c-end" placeholder="Rua, N√∫mero, Bairro">
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;"><label>Data</label><input type="date" id="c-data"></div>
                <div style="flex: 1;"><label>Hora</label><input type="time" id="c-hora"></div>
            </div>
            <label>O que voc√™ precisa?</label>
            <textarea id="c-msg" rows="4" placeholder="Descreva os detalhes..."></textarea>
            <button class="btn btn-confirm" onclick="enviarAgendamento()">üöÄ Enviar para WhatsApp</button>
            <button class="btn btn-outline" style="margin-top:15px; border:none" onclick="irPara('view-login')">‚öôÔ∏è Administrativo</button>
        </div>

        <div id="resumo-cliente" class="hidden" style="text-align:center">
            <h3 style="color:var(--secondary)">Pedido Enviado!</h3>
            <p>Voc√™ ser√° redirecionado para o WhatsApp agora.</p>
            <button class="btn btn-main" onclick="location.reload()">Novo Or√ßamento</button>
        </div>
    </div>

    <div id="view-login" class="card hidden">
        <h3>Acesso Admin</h3>
        <input type="password" id="l-pass" placeholder="Senha">
        <button class="btn btn-main" onclick="login()">Entrar</button>
        <button class="btn btn-outline" style="margin-top:10px; border:none" onclick="irPara('view-cliente')">Voltar</button>
    </div>

    <div id="view-admin" class="card hidden">
        <div class="tabs">
            <div id="t1" class="tab active" onclick="tab(1)">üì¶ Pedidos</div>
            <div id="t2" class="tab" onclick="tab(2)">üìù Or√ßamento</div>
            <div id="t3" class="tab" onclick="tab(3)">üìÇ Cat√°logo</div>
            <div id="t4" class="tab" onclick="tab(4)">‚öôÔ∏è Config</div>
        </div>
        
        <div id="tab-1"><div id="lista-agendamentos">Carregando...</div></div>
        
        <div id="tab-2" class="hidden">
            <input type="text" id="o-nome" placeholder="Nome do Cliente">
            <div id="itens-orc"></div>
            <button class="btn btn-outline" onclick="addLinha()">‚ûï Item</button>
            <h3 id="total-geral" style="text-align:right; margin:20px 0;">R$ 0,00</h3>
            <button class="btn btn-confirm" onclick="prepararPDF()">üìÑ Gerar PDF</button>
        </div>

        <div id="tab-3" class="hidden">
            <input type="text" id="cat-n" placeholder="Servi√ßo">
            <input type="number" id="cat-p" placeholder="Pre√ßo">
            <button class="btn btn-main" onclick="salvarCat()">Salvar</button>
            <div id="tab-cat-corpo" style="margin-top:20px"></div>
        </div>

        <div id="tab-4" class="hidden">
            <label>T√≠tulo do Sistema</label>
            <input type="text" id="m-nome" oninput="salvarDados()">
            
            <label>Seu WhatsApp (Receber pedidos)</label>
            <input type="tel" id="m-tel" oninput="salvarDados()">

            <label>Link desta P√°gina (Para o Bot√£o WhatsApp)</label>
            <input type="text" id="m-link" placeholder="https://seu-site.com" oninput="salvarDados()">
            
            <label>Modelo de Mensagem</label>
            <textarea id="m-msg-modelo" rows="3" oninput="salvarDados()"></textarea>

            <button class="btn btn-outline" onclick="copiarLinkBotao()" style="background:#e0f2fe; color:#0369a1; border:none">üîó Copiar Link p/ Bio do WhatsApp</button>
            <button class="btn btn-outline" style="margin-top:10px" onclick="baixarBackupJSON()">üì• Baixar Backup</button>
        </div>
    </div>
</div>

<div id="area-impressao" class="hidden" style="padding:30px;">
    <h1 id="p-m-nome">Or√ßamento</h1>
    <p>Cliente: <strong id="p-o-nome"></strong></p>
    <div id="p-tabela"></div>
    <h2 id="p-total" style="text-align:right"></h2>
    <button class="no-print btn btn-main" onclick="window.print()">Imprimir PDF</button>
    <button class="no-print btn btn-outline" onclick="location.reload()">Sair</button>
</div>

<script>
    const SCRIPT_URL = "COLE_AQUI_SEU_LINK_DO_GOOGLE";
    let db_cat = JSON.parse(localStorage.getItem('n_cat')) || [];
    let db_meu = JSON.parse(localStorage.getItem('n_meu')) || {
        nome: 'Solicita√ß√£o de Or√ßamento',
        tel: '',
        link: '',
        msgModelo: '*NOVA SOLICITA√á√ÉO*\n\n*Cliente:* {cliente}\n*Local:* {end}\n*Data:* {data}\n*Pedido:* {msg}'
    };

    window.onload = () => {
        document.getElementById('topo-nome-empresa').innerText = db_meu.nome;
        document.getElementById('m-nome').value = db_meu.nome;
        document.getElementById('m-tel').value = db_meu.tel;
        document.getElementById('m-link').value = db_meu.link || '';
        document.getElementById('m-msg-modelo').value = db_meu.msgModelo;
        renderCat();
    };

    function irPara(id) {
        document.querySelectorAll('.container > div').forEach(v => v.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function tab(n) {
        [1,2,3,4].forEach(i => {
            document.getElementById('tab-'+i).classList.toggle('hidden', i!==n);
            document.getElementById('t'+i).classList.toggle('active', i===n);
        });
        if(n === 1) carregarPedidos();
    }

    function login() {
        if(document.getElementById('l-pass').value === "admin123") { irPara('view-admin'); tab(1); }
        else alert("Senha incorreta");
    }

    function maskTel(i) {
        let v = i.value.replace(/\D/g,'');
        v = v.replace(/^(\d{2})(\d)/g,"($1) $2");
        v = v.replace(/(\d)(\d{4})$/,"$1-$2");
        i.value = v;
    }

    function salvarDados() {
        db_meu = {
            nome: document.getElementById('m-nome').value,
            tel: document.getElementById('m-tel').value,
            link: document.getElementById('m-link').value,
            msgModelo: document.getElementById('m-msg-modelo').value
        };
        localStorage.setItem('n_meu', JSON.stringify(db_meu));
        document.getElementById('topo-nome-empresa').innerText = db_meu.nome;
    }

    function copiarLinkBotao() {
        const link = document.getElementById('m-link').value;
        if(!link) return alert("Coloque o link da sua p√°gina primeiro!");
        navigator.clipboard.writeText(link);
        alert("Link copiado! Agora cole no seu Perfil do WhatsApp.");
    }

    async function enviarAgendamento() {
        const d = {
            nome: document.getElementById('c-nome').value,
            tel: document.getElementById('c-tel').value,
            end: document.getElementById('c-end').value,
            dia: document.getElementById('c-data').value,
            hora: document.getElementById('c-hora').value,
            msg: document.getElementById('c-msg').value
        };

        if(!d.nome || !d.tel) return alert("Preencha Nome e WhatsApp!");

        let msgZap = db_meu.msgModelo
            .replace('{cliente}', d.nome).replace('{end}', d.end)
            .replace('{data}', d.dia).replace('{msg}', d.msg);

        window.open(`https://wa.me/${db_meu.tel.replace(/\D/g,'')}?text=${encodeURIComponent(msgZap)}`, '_blank');
        
        irPara('resumo-cliente');
        document.getElementById('rec-nome').innerText = d.nome;

        if(SCRIPT_URL !== "COLE_AQUI_SEU_LINK_DO_GOOGLE") {
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(d) });
        }
    }

    // Fun√ß√µes de Pedidos, Cat√°logo e Or√ßamento mantidas conforme pedido
    async function carregarPedidos() {
        const lista = document.getElementById('lista-agendamentos');
        if(SCRIPT_URL === "COLE_AQUI_SEU_LINK_DO_GOOGLE") { lista.innerHTML = "Configure o SCRIPT_URL."; return; }
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            lista.innerHTML = "";
            data.slice(1).reverse().forEach(r => {
                lista.innerHTML += `<div class="pedido-card"><strong>${r[1]}</strong><br><small>${r[4]}</small><br><button onclick="iniciarOrc('${r[1]}')">Criar Or√ßamento</button></div>`;
            });
        } catch(e) { lista.innerHTML = "Erro ao carregar."; }
    }

    function iniciarOrc(nome) { document.getElementById('o-nome').value = nome; tab(2); }

    function addLinha(n='', p='') {
        const div = document.createElement('div'); div.className = 'item-row';
        div.innerHTML = `<input type="text" value="${n}" class="in"> <input type="number" value="1" class="iq" oninput="calc()"> <input type="number" value="${p}" class="ip" oninput="calc()"> <button onclick="this.parentElement.remove();calc()">√ó</button>`;
        document.getElementById('itens-orc').appendChild(div);
        calc();
    }

    function calc() {
        let total = 0;
        document.querySelectorAll('.item-row').forEach(row => {
            total += (row.querySelector('.iq').value * row.querySelector('.ip').value);
        });
        document.getElementById('total-geral').innerText = `R$ ${total.toLocaleString('pt-BR',{minimumFractionDigits:2})}`;
    }

    function salvarCat() {
        db_cat.push({n: document.getElementById('cat-n').value, p: document.getElementById('cat-p').value});
        localStorage.setItem('n_cat', JSON.stringify(db_cat));
        renderCat();
    }

    function renderCat() {
        const t = document.getElementById('tab-cat-corpo'); t.innerHTML = "";
        db_cat.forEach((item, i) => {
            t.innerHTML += `<div class="pedido-card">${item.n} - R$ ${item.p} <button onclick="addLinha('${item.n}','${item.p}')">+</button></div>`;
        });
    }

    function prepararPDF() {
        document.getElementById('p-m-nome').innerText = db_meu.nome;
        document.getElementById('p-o-nome').innerText = document.getElementById('o-nome').value;
        document.getElementById('p-total').innerText = document.getElementById('total-geral').innerText;
        let h = '<table style="width:100%">';
        document.querySelectorAll('.item-row').forEach(row => {
            h += `<tr><td>${row.querySelector('.in').value}</td><td>${row.querySelector('.iq').value}</td><td>R$ ${row.querySelector('.ip').value}</td></tr>`;
        });
        document.getElementById('p-tabela').innerHTML = h + '</table>';
        document.querySelector('.container').classList.add('hidden');
        document.getElementById('area-impressao').classList.remove('hidden');
    }

    function baixarBackupJSON() {
        const blob = new Blob([JSON.stringify({cat:db_cat, meu:db_meu}, null, 2)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `backup_sistema.json`;
        link.click();
    }
</script>

</body>
</html>
